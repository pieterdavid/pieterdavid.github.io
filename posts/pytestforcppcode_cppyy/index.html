<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Testing C++ code with pytest, through cppyy/PyROOT | Pieter David's blog</title>
<link href="../../assets/css/all.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.5/css/fork-awesome.min.css" integrity="sha256-P64qV9gULPHiZTdrS1nM59toStkgjM0dsf5mK/UwBV4=" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&amp;display=swap" rel="stylesheet">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://pieterdavid.github.io/posts/pytestforcppcode_cppyy/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Pieter David">
<link rel="prev" href="../histogramsvisualisation/" title="A few remarks about drawing histograms" type="text/html">
<meta property="og:site_name" content="Pieter David's blog">
<meta property="og:title" content="Testing C++ code with pytest, through cppyy/PyROOT">
<meta property="og:url" content="https://pieterdavid.github.io/posts/pytestforcppcode_cppyy/">
<meta property="og:description" content="One of the things that have been extremely helpful in developing the bamboo
package, and especially some of its C++ components, are a collection of unit
and regression tests.
Of course the value of au">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-09-17T13:45:00+02:00">
<link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">

        <nav role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../"><i class="fa fa-2x fa-fw fa-home"></i> Home</a>
        </nav><nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../archive.html">Archive</a>
        <a class="sidebar-nav-item" href="../../categories/">Tags</a>
        <a class="sidebar-nav-item" href="../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h2 id="brand" class="masthead-title">
      <a href="https://pieterdavid.github.io/" title="Pieter David's blog" rel="home">Pieter David's blog</a>
    </h2>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/BlogPosting"><header><h1 class="post-title p-name entry-title" itemprop="headline">
      <a href="https://pieterdavid.github.io/posts/pytestforcppcode_cppyy/" class="u-url">Testing C++ code with pytest, through cppyy/PyROOT</a>
</h1>
        <div class="metadata">
        <meta itemprop="inLanguage" content="en">
<p class="dateline">
            <time class="post-date published dt-published" datetime="2021-09-17T13:45:00+02:00" itemprop="datePublished" title="2021-09-17 13:45">2021-09-17 13:45</time></p>
                <p class="commentline">
    
<a href="#comment-section">Comments</a>


        </p>
</div>
        

    </header><section class="e-content entry-content" itemprop="articleBody text"><p>One of the things that have been extremely helpful in developing the <a class="reference external" href="https://bamboo-hep.readthedocs.io/">bamboo</a>
package, and especially some of its C++ components, are a <a class="reference external" href="https://bamboo-hep.readthedocs.io/en/latest/hacking.html#running-the-tests-or-adding-test-cases">collection of unit
and regression tests</a>.
Of course the value of automatic or easy-to-run tests is well-known in
software engineering, but they are not as commonly used in code used for
high-energy physics research as they could be: underlying frameworks and
critical algorithms are often covered quite well, but the code used for
final few steps to the results in a publication, and some of the code
supporting this final analysis, often much less so, or not at all.
Therefore this post is another advertisement for <a class="reference external" href="https://docs.pytest.org/en/">pytest</a>, especially how
it can also be used for testing C++ code through the automatic python bindings
generated by <a class="reference external" href="https://cppyy.readthedocs.io/">cppyy</a>.</p>
<p>For <a class="reference external" href="https://docs.pytest.org/en/">pytest</a> in general I can only recommend to have a look at its documentation:
it is very easy to use, most of the time setting up a test is really as simple
as writing something like</p>
<div class="code"><pre class="code python"><a id="rest_code_6d8e11e3bd03436f9fe669d59c4afbbe-1" name="rest_code_6d8e11e3bd03436f9fe669d59c4afbbe-1" href="#rest_code_6d8e11e3bd03436f9fe669d59c4afbbe-1"></a><span class="k">def</span> <span class="nf">test_calculation_1</span><span class="p">():</span>
<a id="rest_code_6d8e11e3bd03436f9fe669d59c4afbbe-2" name="rest_code_6d8e11e3bd03436f9fe669d59c4afbbe-2" href="#rest_code_6d8e11e3bd03436f9fe669d59c4afbbe-2"></a>    <span class="k">assert</span> <span class="n">do_calculation</span><span class="p">(</span><span class="n">some_inputs</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_result</span>
</pre></div>
<p>to a <code class="docutils literal"><span class="pre">test_&lt;something&gt;.py</span></code> file, and running <code class="docutils literal">pytest</code>â€”it is also easy
to select just some tests to run with <code class="docutils literal">pytest <span class="pre">-k</span> 'expression'</code>, or by passing
the name of a test file, add helper methods in the tests, reuse an object
for several tests, or conditionally skip some tests if e.g. a dependency may be
absent, to name just a few features that are used in the <a class="reference external" href="https://bamboo-hep.readthedocs.io/">bamboo</a> tests.</p>
<p>Getting to the point of this post: when using a mix of python and C++ code,
and in case (Py)ROOT_ already used somehow (otherwise it is a rather large
dependency to add just for this), it takes very little extra effort to include
tests for the C++ code in <a class="reference external" href="https://docs.pytest.org/en/">pytest</a>.
The key point is that <a class="reference external" href="https://cppyy.readthedocs.io/">cppyy</a>, the underlying technology used by <a class="reference external" href="https://root.cern/manual/python/">PyROOT</a>,
automatically generates python bindings for C++ code that is loaded in the
<a class="reference external" href="https://root.cern/cling/">cling</a> interpreter, as is described in
<a class="reference external" href="https://root.cern/manual/python/#loading-user-libraries-and-just-in-time-compilation-jitting">this part of the PyROOT manual</a>.
As a first example the folling code will JIT-compile a C++ function, and use it
in a few tests:</p>
<div class="code"><pre class="code python"><a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-1" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-1" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-1"></a><span class="kn">import</span> <span class="nn">pytest</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-2" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-2" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-2"></a><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isclose</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-3" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-3" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-3"></a>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-4" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-4" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-4"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"session"</span><span class="p">)</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-5" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-5" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-5"></a><span class="k">def</span> <span class="nf">my_square</span><span class="p">():</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-6" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-6" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-6"></a>    <span class="kn">import</span> <span class="nn">ROOT</span> <span class="k">as</span> <span class="nn">gbl</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-7" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-7" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-7"></a>    <span class="n">gbl</span><span class="o">.</span><span class="n">gInterpreter</span><span class="o">.</span><span class="n">Declare</span><span class="p">(</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-8" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-8" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-8"></a>        <span class="s2">"double my_square(double a) {</span><span class="se">\n</span><span class="s2">"</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-9" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-9" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-9"></a>        <span class="s2">"  return a*a;</span><span class="se">\n</span><span class="s2">"</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-10" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-10" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-10"></a>        <span class="s2">"}"</span><span class="p">)</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-11" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-11" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-11"></a>    <span class="k">yield</span> <span class="n">gbl</span><span class="o">.</span><span class="n">my_square</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-12" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-12" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-12"></a>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-13" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-13" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-13"></a><span class="k">def</span> <span class="nf">test_square_0</span><span class="p">(</span><span class="n">my_square</span><span class="p">):</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-14" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-14" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-14"></a>    <span class="k">assert</span> <span class="n">isclose</span><span class="p">(</span><span class="n">my_square</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="mf">0.</span><span class="p">)</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-15" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-15" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-15"></a>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-16" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-16" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-16"></a><span class="k">def</span> <span class="nf">test_square_1</span><span class="p">(</span><span class="n">my_square</span><span class="p">):</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-17" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-17" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-17"></a>    <span class="k">assert</span> <span class="n">isclose</span><span class="p">(</span><span class="n">my_square</span><span class="p">(</span><span class="mf">1.</span><span class="p">),</span> <span class="mf">1.</span><span class="p">)</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-18" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-18" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-18"></a>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-19" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-19" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-19"></a><span class="k">def</span> <span class="nf">test_square_m3</span><span class="p">(</span><span class="n">my_square</span><span class="p">):</span>
<a id="rest_code_a8caebf0ef2a4592a379e10827fcc385-20" name="rest_code_a8caebf0ef2a4592a379e10827fcc385-20" href="#rest_code_a8caebf0ef2a4592a379e10827fcc385-20"></a>    <span class="k">assert</span> <span class="n">isclose</span><span class="p">(</span><span class="n">my_square</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">),</span> <span class="mf">9.</span><span class="p">)</span>
</pre></div>
<p>This is a little bit too simplistic, because we only tested the code that was
defined inside the test file, but the principle remains the same.</p>
<p>C++ headers can be loaded (JIT-compiled) into <a class="reference external" href="https://root.cern/manual/python/">PyROOT</a> and <a class="reference external" href="https://root.cern/cling/">cling</a> with
<code class="docutils literal"><span class="pre">gbl.gROOT.ProcessLine('#include</span> <span class="pre">"myheader.h"')</span></code>, and shared libraries with
<code class="docutils literal"><span class="pre">gbl.gSystem.Load('libname')</span></code>.
It may be useful to append include and linker paths, which can be done with
<code class="docutils literal">gbl.gInterpreter.AddIncludePath</code> and <code class="docutils literal">gbl.gSystem.AddDynamicPath</code>,
respectively (<a class="reference external" href="https://bamboo-hep.readthedocs.io/">bamboo</a> includes some
<a class="reference external" href="https://gitlab.cern.ch/cp3-cms/bamboo/-/blob/master/bamboo/root.py#L23-74">helper functions</a>
to make this more convenient, and a
<a class="reference external" href="https://bamboo-hep.readthedocs.io/en/latest/apiref.html#bamboo.root.loadDependency">loadDependency</a>
helper method that combines all of them).</p>
<p>It is worth stressing that, since <a class="reference external" href="https://root.cern/manual/python/">PyROOT</a> is based on <a class="reference external" href="https://root.cern/cling/">cling</a>, the exact same
function calls make externally defined C++ code available for use in JITted
C++ strings elsewhere in <a class="reference external" href="https://root.cern">ROOT</a>, e.g. in <a class="reference external" href="https://root.cern/doc/master/classROOT_1_1RDataFrame.html">RDataFrame</a>.
It should also be possible to use standalone <a class="reference external" href="https://cppyy.readthedocs.io/">cppyy</a> instead of <a class="reference external" href="https://root.cern/manual/python/">PyROOT</a>
(and <code class="docutils literal">cppyy.include</code> and <code class="docutils literal">cppyy.load_library</code> instead of the ROOT methods),
but I have no experience with that.</p>
<p>How to compile the shared library is beyond the scope of this post, but the
main constraints are that the same C++ ABI must be used as by <a class="reference external" href="https://root.cern/cling/">cling</a>, and the
symbols that are used must be visible (that is the default setting on GNU/Linux,
but may need extra care for cross-platform packages).</p>
<p>A more typical example set of unit tests for a C++ class may then look like this:</p>
<div class="code"><pre class="code python"><a id="rest_code_e820982a0af049da8bbb80698d7e5d19-1" name="rest_code_e820982a0af049da8bbb80698d7e5d19-1" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-1"></a><span class="kn">import</span> <span class="nn">pytest</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-2" name="rest_code_e820982a0af049da8bbb80698d7e5d19-2" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-2"></a><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isclose</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-3" name="rest_code_e820982a0af049da8bbb80698d7e5d19-3" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-3"></a>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-4" name="rest_code_e820982a0af049da8bbb80698d7e5d19-4" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-4"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"session"</span><span class="p">)</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-5" name="rest_code_e820982a0af049da8bbb80698d7e5d19-5" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-5"></a><span class="k">def</span> <span class="nf">loadMyClass</span><span class="p">():</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-6" name="rest_code_e820982a0af049da8bbb80698d7e5d19-6" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-6"></a>    <span class="kn">import</span> <span class="nn">ROOT</span> <span class="k">as</span> <span class="nn">gbl</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-7" name="rest_code_e820982a0af049da8bbb80698d7e5d19-7" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-7"></a>    <span class="n">gbl</span><span class="o">.</span><span class="n">gSystem</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="s2">"lib/libMyClass.so"</span><span class="p">)</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-8" name="rest_code_e820982a0af049da8bbb80698d7e5d19-8" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-8"></a>    <span class="n">gbl</span><span class="o">.</span><span class="n">gInterpreter</span><span class="o">.</span><span class="n">ProcessLine</span><span class="p">(</span><span class="s1">'#include "include/MyClass.h"'</span><span class="p">)</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-9" name="rest_code_e820982a0af049da8bbb80698d7e5d19-9" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-9"></a>    <span class="k">yield</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-10" name="rest_code_e820982a0af049da8bbb80698d7e5d19-10" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-10"></a>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-11" name="rest_code_e820982a0af049da8bbb80698d7e5d19-11" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-11"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"module"</span><span class="p">)</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-12" name="rest_code_e820982a0af049da8bbb80698d7e5d19-12" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-12"></a><span class="k">def</span> <span class="nf">myclass_hello42</span><span class="p">(</span><span class="n">loadMyClass</span><span class="p">):</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-13" name="rest_code_e820982a0af049da8bbb80698d7e5d19-13" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-13"></a>    <span class="kn">import</span> <span class="nn">ROOT</span> <span class="k">as</span> <span class="nn">gbl</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-14" name="rest_code_e820982a0af049da8bbb80698d7e5d19-14" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-14"></a>    <span class="k">yield</span> <span class="n">gbl</span><span class="o">.</span><span class="n">MyClass</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-15" name="rest_code_e820982a0af049da8bbb80698d7e5d19-15" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-15"></a>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-16" name="rest_code_e820982a0af049da8bbb80698d7e5d19-16" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-16"></a><span class="k">def</span> <span class="nf">test_myclass_hello42_get</span><span class="p">(</span><span class="n">myclass_hello42</span><span class="p">):</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-17" name="rest_code_e820982a0af049da8bbb80698d7e5d19-17" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-17"></a>    <span class="k">assert</span> <span class="n">myclass_hello42</span><span class="o">.</span><span class="n">getMagic</span><span class="p">()</span> <span class="o">==</span> <span class="mi">42</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-18" name="rest_code_e820982a0af049da8bbb80698d7e5d19-18" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-18"></a>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-19" name="rest_code_e820982a0af049da8bbb80698d7e5d19-19" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-19"></a><span class="k">def</span> <span class="nf">test_myclass_hello42_msg</span><span class="p">(</span><span class="n">myclass_hello42</span><span class="p">):</span>
<a id="rest_code_e820982a0af049da8bbb80698d7e5d19-20" name="rest_code_e820982a0af049da8bbb80698d7e5d19-20" href="#rest_code_e820982a0af049da8bbb80698d7e5d19-20"></a>    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">myclass_hello42</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span> <span class="o">==</span> <span class="s2">"Hello, the magic number is 42"</span>
</pre></div>
<p>The fixtures in <a class="reference external" href="https://docs.pytest.org/en/">pytest</a> allow to efficiently implement more complicated tests.
Some more examples may be found in the
<a class="reference external" href="https://gitlab.cern.ch/cp3-cms/bamboo/-/tree/master/tests">bamboo tests</a>.
An interesting case are the tests to make sure that the included C++
implementation of the recipes to calculate variations of measured jet and MET
momenta (reconstructed quantities in LHC collisions, the variations are used to
estimate the effect of imprecise knowledge of some corrections on the final
results) gives the same results as the reference implementation.
This is done by including a file with all the inputs and the outputs from the
reference implementation, and then inside the tests compare the calculated
results with the reference results.
All the code for this can be found in
<a class="reference external" href="https://gitlab.cern.ch/cp3-cms/bamboo/-/blob/master/tests/test_jmesystcalc.py">tests/test_jmesystcalc.py</a>;
these calculators, and their tests, are also available as a standalone package
<a class="reference external" href="https://github.com/pieterdavid/CMSJMECalculators">pieterdavid/CMSJMECalculators</a>.</p>
    </section><aside class="sharing no-print"><a href="#content" aria-label="Post beginning">
       <i class="fa fa-2x fa-fw fa-arrow-circle-up" aria-hidden="true" title="Post beginning"></i>
    </a>
    <a href="https://pieterdavid.github.io/posts/histogramsvisualisation/" rel="prev" title="A few remarks about drawing histograms">
       <i class="fa fa-2x fa-fw fa-arrow-circle-left" aria-hidden="true" title="Previous post: A few remarks about drawing histograms"></i>
    </a>
    <span class="post-sharing">
     <a href="http://twitter.com/share?text=Testing+C%2B%2B+code+with+pytest%2C+through+cppyy%2FPyROOT&amp;url=https%3A%2F%2Fpieterdavid.github.io%2Fposts%2Fpytestforcppcode_cppyy%2F" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" aria-label="Share on Twitter">
       <i class="fa fa-2x fa-fw fa-twitter" aria-hidden="true" title="Share on Twitter">
     </i></a>
     <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fpieterdavid.github.io%2Fposts%2Fpytestforcppcode_cppyy%2F" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" aria-label="Share on Facebook">
       <i class="fa fa-2x fa-fw fa-facebook" style="margin-left: -8px" aria-hidden="true" title="Share of Facebook">
     </i></a>
     <a href="https://wa.me/?text=https%3A%2F%2Fpieterdavid.github.io%2Fposts%2Fpytestforcppcode_cppyy%2F" aria-label="Share on WhatsApp">
       <i class="fa fa-2x fa-fw fa-whatsapp" style="margin-left: -8px" aria-hidden="true" title="Share on WhatsApp">
     </i></a>
     </span>
</aside><div itemprop="author" itemscope itemtype="http://schema.org/Person">
<footer class="byline author author-bio vcard"><hr>
<meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8883677?s=460&amp;v=4">
<div class="author-image" style="background: url(https://avatars0.githubusercontent.com/u/8883677?s=460&amp;v=4)"></div>
     <h3 class="byline-name fn" itemprop="name">Pieter David
        <span class="post-sharing">
            <a href="mailto:pieter(point)david(at)SPAMNOTgmail(point)com?subject=Testing%20C++%20code%20with%20pytest,%20through%20cppyy/PyROOT" aria-label="Email author">
            <i class="fa fa-fw fa-envelope" aria-hidden="true" title="Email author">
            </i></a>
        </span>
        <span class="post-sharing">
            <a href="http://twitter.com/pieterdavid_" target="_blank" arial-label="Go to Twitter"> <i class="fa fa-fw fa-twitter" aria-hidden="true" title="Twitter"></i></a>
            <a href="https://www.linkedin.com/in/pieter-david-a04a77ab/" target="_blank" arial-label="Go to LinkedIn"> <i class="fa fa-fw fa-linkedin" aria-hidden="true" title="LinkedIn"></i></a>
            <a href="http://github.com/pieterdavid" target="_blank" arial-label="Go to GitHub"> <i class="fa fa-fw fa-github" aria-hidden="true" title="GitHub"></i></a>
        </span>
     </h3>
     <p><i class="fas fa-map-marker"></i> Brussels, Belgium</p>
</footer>
</div>


        <section class="comments hidden-print"><h2>Comments</h2>
        
    
<script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script><div id="comment-section"></div>

<script>
initComments({
  node: document.getElementById("comment-section"),
  defaultHomeserverUrl: "https://matrix.cactus.chat:8448",
  serverName: "cactus.chat",
  siteName: "pieterdavid-personalblog",
  commentSectionId: "testing-c++-code-with-pytest-through-cppyypyroot"
})
</script></section></article><footer id="footer"><p>Contents Â© 2024         Pieter David - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License BY-SA" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"></a></p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
    
            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
