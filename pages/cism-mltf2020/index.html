<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Material for the CISM/CÉCI training session on 10/11/2020, see https://indico.cism.ucl.ac.be/event/84/">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Machine learning with Tensorflow: an introduction | Pieter David's blog</title>
<link href="../../assets/css/all.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.5/css/fork-awesome.min.css" integrity="sha256-P64qV9gULPHiZTdrS1nM59toStkgjM0dsf5mK/UwBV4=" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&amp;display=swap" rel="stylesheet">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://pieterdavid.github.io/pages/cism-mltf2020/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Pieter David">
<meta property="og:site_name" content="Pieter David's blog">
<meta property="og:title" content="Machine learning with Tensorflow: an introduction">
<meta property="og:url" content="https://pieterdavid.github.io/pages/cism-mltf2020/">
<meta property="og:description" content="Material for the CISM/CÉCI training session on 10/11/2020, see https://indico.cism.ucl.ac.be/event/84/">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-11-03T19:36:53+01:00">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">

        <nav role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../"><i class="fa fa-2x fa-fw fa-home"></i> Home</a>
        </nav><nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../archive.html">Archive</a>
        <a class="sidebar-nav-item" href="../../categories/">Tags</a>
        <a class="sidebar-nav-item" href="../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h2 id="brand" class="masthead-title">
      <a href="https://pieterdavid.github.io/" title="Pieter David's blog" rel="home">Pieter David's blog</a>
    </h2>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/BlogPosting"><header><h1 class="post-title p-name entry-title" itemprop="headline">
      <a href="https://pieterdavid.github.io/pages/cism-mltf2020/" class="u-url">Machine learning with Tensorflow: an introduction</a>
</h1>
        <div class="metadata">
        <meta itemprop="inLanguage" content="en">
<meta name="description" itemprop="description" content="Material for the CISM/CÉCI training session on 10/11/2020, see https://indico.cism.ucl.ac.be/event/84/">
</div>
        

    </header><section class="e-content entry-content" itemprop="articleBody text"><div>
<p><em>This page collects the material for for the CISM/CÉCI training session on 10/11/2020,
see the</em> <a class="reference external" href="https://indico.cism.ucl.ac.be/event/84/">indico page</a> <em>for more details.</em></p>
<div class="section" id="table-of-contents">
<h2>Table of contents</h2>
<ul class="simple">
<li><p><a class="reference external" href="mlintro.html">A brief introduction to machine learning</a></p></li>
<li><p><a class="reference external" href="tfprimer.html">A more technical introduction to Tensorflow</a></p></li>
<li><p><a class="reference external" href="morenningredients.html">Other building blocks and architectures</a></p></li>
<li><p><a class="reference external" href="exercise1.html">Your turn: an exercise</a></p></li>
</ul>
</div>
<div class="section" id="to-make-it-more-interactive">
<h2>To make it more interactive</h2>
<p>While not absolutely essential, it is nice if you can try some things yourself
(time permitting, there are also some exercises), so if possible you should
try to set up an environment where you can play a bit with <a class="reference external" href="https://www.tensorflow.org">Tensorflow</a> (ideally
before the training, to save a bit of time).</p>
<div class="section" id="using-colaboratory">
<h3>Using <a class="reference external" href="https://colab.research.google.com/">Colaboratory</a>
</h3>
<p>If you have a Google account, you can use <a class="reference external" href="https://colab.research.google.com/">Colaboratory</a> to interactively edit
and run notebooks.
The environment is meant for machine learning, so no additional setup is
required (resources are not guaranteed, but likely sufficient for anything we
will do this afternoon).</p>
</div>
<div class="section" id="on-manneback">
<h3>On manneback</h3>
<p>The simplest way (since you are assumed to have an account,
and to be familiar with using SSH and the command line) if you have a stable
internet connection is to open a terminal and launch an interactive job with slurm on the
<a class="reference external" href="https://www.cism.ucl.ac.be/doc/_contents/Computing/index.html#id1">Manneback</a> cluster.</p>
<p>First connect to the interactive node:</p>
<pre class="code sh"><a name="rest_code_c49a13c501e046288480dc02f627b019-1"></a>ssh gwceci.cism.ucl.ac.be <span class="c1"># or gwcism.cism.ucl.ac.be</span>
<a name="rest_code_c49a13c501e046288480dc02f627b019-2"></a>ssh manneback.cism.ucl.ac.be
</pre>
<p>We will in any case launch an interactive job on the worker (such that we
don't all compete for resources on the same machine), but there are two options:
the most convenient is to launch a <a class="reference external" href="http://jupyter.org">Jupyter</a> kernel, such that you can edit the
notebook (and view some figures) from the browser on your personal computer.</p>
<p>This needs a tunnel to manneback, which can be set up with <a class="reference external" href="https://sshuttle.readthedocs.io/en/stable/">sshuttle</a> following
the <a class="reference external" href="https://www.cism.ucl.ac.be/doc/_contents/Other/index.html#jupyter">CISM instructions</a>,
and changing the <code class="docutils literal">srun</code> command to</p>
<pre class="code sh"><a name="rest_code_73210c8be1574a749c2b049b2e14df3c-1"></a>srun --pty bash -c <span class="s1">'source /cvmfs/sft.cern.ch/lcg/views/LCG_98python3/x86_64-centos7-gcc9-opt/setup.sh; jupyter notebook --ip $(hostname -i) --no-browser'</span>
</pre>
<p>which will run</p>
<pre class="code sh"><a name="rest_code_cf36f7aa91b04da2b6e3e33ac736d295-1"></a><span class="nb">source</span> /cvmfs/sft.cern.ch/lcg/views/LCG_98python3/x86_64-centos7-gcc9-opt/setup.sh
<a name="rest_code_cf36f7aa91b04da2b6e3e33ac736d295-2"></a>jupyter notebook --ip <span class="k">$(</span>hostname -i<span class="k">)</span> --no-browser
</pre>
<p>in an interactive slurm job: source an environment setup script, and launch
a <a class="reference external" href="http://jupyter.org">Jupyter</a> kernel..
Slurm may take a few seconds to assign you a worker node, then the kernel
should print a few lines.
At the end, there should be "Or copy and paste one of these URLs:",
with at least one URL that starts with <code class="docutils literal"><span class="pre">http://10....</span></code>.
Thanks to the tunnel you can open this in a web browser on your laptop/desktop
(which is a better idea than running a web browser with X11 forwarding).</p>
<p>To check that everything is working correctly, you can create a test notebook
somewhere in your home directory, and try the following to check that
<a class="reference external" href="https://www.tensorflow.org">Tensorflow</a> is correctly set up:</p>
<pre class="code python"><a name="rest_code_b2f4c8e9e64d45959503d78716c3d31d-1"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<a name="rest_code_b2f4c8e9e64d45959503d78716c3d31d-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">__version_</span><span class="p">)</span>
</pre>
<p>The main advantage of the notebook over an <a class="reference external" href="http://ipython.org">IPython</a> session is that this gives
an inline figure:</p>
<pre class="code python"><a name="rest_code_a7cd368347e144af8a9691fdeb817543-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a name="rest_code_a7cd368347e144af8a9691fdeb817543-2"></a><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<a name="rest_code_a7cd368347e144af8a9691fdeb817543-3"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<a name="rest_code_a7cd368347e144af8a9691fdeb817543-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre>
</div>
<div class="section" id="using-binder">
<h3>Using <a class="reference external" href="https://mybinder.org">binder</a>
</h3>
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/pieterdavid/cism-mltf2020-docker/main"><img alt="https://mybinder.org/badge_logo.svg" src="https://mybinder.org/badge_logo.svg"></a>
<p>The badge above will launch a <a class="reference external" href="https://mybinder.org">binder</a> session with an environment prepared
for the exercises.
Resources will be limited, so some of the larger networks may not finish
training.</p>
</div>
<div class="section" id="locally">
<h3>Locally</h3>
<p>If your internet connection is not very stable, or you are used to running
python on your personal computer or elsewhere, you can also install <a class="reference external" href="https://www.tensorflow.org">Tensorflow</a>
in a <a class="reference external" href="https://docs.conda.io/en/latest/">conda</a> environment, or (preferably in a <a class="reference external" href="https://docs.conda.io/en/latest/">virtual environment</a>) with pip,
more details can be found in the <a class="reference external" href="https://www.tensorflow.org/install">installation instructions</a>.</p>
<p>With <a class="reference external" href="https://docs.conda.io/en/latest/">conda</a>, all you should need is this:</p>
<pre class="code sh"><a name="rest_code_96575083357e44648c311b62f434e594-1"></a>conda config --add channels conda-forge <span class="c1"># if not already the case</span>
<a name="rest_code_96575083357e44648c311b62f434e594-2"></a>conda create -n mltftraining2020 <span class="nv">tensorflow</span><span class="o">=</span><span class="m">2</span>.3.0 <span class="nv">tensorboard</span><span class="o">=</span><span class="m">2</span>.3.0 ipython matplotlib ipykernel
<a name="rest_code_96575083357e44648c311b62f434e594-3"></a>conda activate mltftraining2020
<a name="rest_code_96575083357e44648c311b62f434e594-4"></a>ipython kernel install --user --name <span class="s2">"mltftraining2020"</span>
</pre>
<p>And with virtualenv and pip:</p>
<pre class="code sh"><a name="rest_code_1ed1217f1e704d489f424e52f0ed73ef-1"></a>python -m venv mltftraining2020 <span class="c1"># pick a name</span>
<a name="rest_code_1ed1217f1e704d489f424e52f0ed73ef-2"></a><span class="nb">source</span> mltftraining2020/bin/activate
<a name="rest_code_1ed1217f1e704d489f424e52f0ed73ef-3"></a>pip install tensorflow tensorboard ipython matplotlib ipykernel
<a name="rest_code_1ed1217f1e704d489f424e52f0ed73ef-4"></a>ipython kernel install --user --name <span class="s2">"mltftraining2020"</span>
</pre>
<p>If you do not already have the <a class="reference external" href="http://jupyter.org">Jupyter</a> notebook server installed, you should
add the <code class="docutils literal">notebook</code> package to the conda or pip install command.
The last line installs a kernel that you can select to run the notebook with.</p>
<p>The exercises assume that you are have at least version 2.1.0 of <a class="reference external" href="https://www.tensorflow.org">Tensorflow</a>,
which requires Python 3.5 or above.</p>
<p>You could also reuse the docker image used by <a class="reference external" href="https://mybinder.org">binder</a> above, it is available
on dockerhub as
<a class="reference external" href="https://hub.docker.com/r/pieterdavid/cism-mltf2020-docker">pieterdavid/cism-mltf2020-docker</a>,
and can be pulled with</p>
<pre class="code sh"><a name="rest_code_d72eb81b977e4475a184f15cfe92c589-1"></a>docker pull pieterdavid/cism-mltf2020-docker
</pre>
</div>
</div>
</div>
    </section></article><footer id="footer"><p>Contents © 2020         Pieter David - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License BY-SA" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"></a></p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
    
            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
